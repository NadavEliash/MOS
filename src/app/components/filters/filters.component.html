<div class="wrapper">
  <div class="segmentation" dir="rtl">
    <div class="segmentation-scroll-wrapper">
        <div class="segmentation-header">
            <h2 class="segmentation-title">×¤×™×œ×•×—</h2>
            <button class="reset-button" (click)="resetFilters()">××™×¤×•×¡</button>
        </div>
        <div class="measures-group">
        @if (showGrouped) {
            @for (group of groupedMeasures; track group.id) {
                <div class="measure-item">
                    <div class="measure-title" (click)="selectGroup(group)">
                        <span>{{ group.name }}</span>
                        <img class="left-arrow" src="/assets/measure-arrow.svg" alt="â—€ï¸"/>
                    </div>
                </div>
            }
        } @else {
            @if (selectedGroupName) { 
                <div class="grouped-measure-title" (click)="showGrouped = true">
                    <img class="right-arrow" src="/assets/measure-arrow.svg" alt="â—€ï¸"/>
                    <span class="selected-group-title">{{ selectedGroupName }}</span>
                </div> }
            @for (measure of measures; track measure.id) {
                <div class="measure-item">
                    <div class="measure-title" [class.expanded]="measure.expanded" (click)="toggleMeasure(measure)">
                        <span>{{ measure.name }}</span>
                        <img class="arrow" [class.expanded]="measure.expanded" src="/assets/filter-arrow.svg" alt="ğŸ”½"/>
                    </div>
                    @if (measure.expanded) {
                        <div class="filter-groups-container">
                            @for (group of getFilterGroupsForMeasure(measure.id); track group.filter.id) {
                                <div class="filter-group-item" [class.disabled]="group.filter.disabled">
                                    <div class="group-header" [class.expanded]="group.filter.expanded" (click)="!group.filter.disabled && toggleFilterGroup(group)">
                                        <img class="arrow-left" [class.expanded]="group.filter.expanded" src="/assets/measure-arrow.svg" alt="â—€ï¸"/>
                                        <span class="group-title">{{ group.filter.name }}</span>
                                    </div>
                                    @if (group.filter.expanded) {
                                        <div class="group-content">
                                            @if (hasManyLabals(group)) {
                                                <!-- <label class="checkbox-label select-all">
                                                    <input type="checkbox" [checked]="areAllSelected(group)" (change)="toggleSelectAll(group)" [disabled]="group.filter.disabled">
                                                    <span class="checkmark"></span>
                                                    ×‘×—×¨ ×”×›×œ
                                                </label> -->
                                                <div class="search-wrapper">
                                                    <img class="search-icon" src="/assets/search-icon.svg" alt="ğŸ”"/>
                                                    <input type="text" class="search-input" placeholder="×—×™×¤×•×©..." (input)="onSearchChange($event, group.filter.id)">
                                                </div>
                                            }
                                            @for (label of getFilteredLabels(group); track label.title) {
                                                <label class="checkbox-label">
                                                    <input type="checkbox" [checked]="label.data.checked" (change)="onCheckboxChange(label)" [disabled]="group.filter.disabled">
                                                    <span class="checkmark"></span>
                                                    {{ label.title }}
                                                </label>
                                            }
                                        </div>
                                    }
                                </div>
                            }
                        </div>
                    }
                </div>
            }
        }
        </div>
    </div>
  </div>
  <div class="graph">
    <app-graph 
      [data]="currentGraphData()" 
      [filterGroups]="filterGroupsInput"
      (graphSaved)="onGraphSaved()">
    </app-graph>
  </div>
</div>